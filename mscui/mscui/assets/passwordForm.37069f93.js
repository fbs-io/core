import{_ as b,h as y,i as V,j as E,k as O,o as k,e as T,w as s,f as e,l as u,t as m,g as I,m as v,n as P,p as N,q as S,s as C}from"./index.8c95325c.js";const F={data(){return{userType:"admin",form:{user:"admin",password:"admin",autologin:!1},rules:{user:[{required:!0,message:this.$t("login.userError"),trigger:"blur"}],password:[{required:!0,message:this.$t("login.PWError"),trigger:"blur"}]},islogin:!1}},watch:{userType(o){o=="admin"?(this.form.user="admin",this.form.password="admin"):o=="user"&&(this.form.user="user",this.form.password="user")}},mounted(){},methods:{async login(){var o=await this.$refs.loginForm.validate().catch(()=>{});if(!o)return!1;this.islogin=!0;var t={username:this.form.user,password:this.$TOOL.crypto.MD5(this.form.password)},n=await this.$API.auth.token.post(t);if(n.code==200)this.$TOOL.cookie.set("TOKEN",n.data.token,{expires:this.form.autologin?24*60*60:0}),this.$TOOL.data.set("USER_INFO",n.data.userInfo);else return this.islogin=!1,this.$message.warning(n.message),!1;var r=null;if(this.form.user=="admin"?r=await this.$API.system.menu.myMenus.get():r=await this.$API.demo.menu.get(),r.code==200){if(r.data.menu.length==0)return this.islogin=!1,this.$alert("\u5F53\u524D\u7528\u6237\u65E0\u4EFB\u4F55\u83DC\u5355\u6743\u9650\uFF0C\u8BF7\u8054\u7CFB\u7CFB\u7EDF\u7BA1\u7406\u5458","\u65E0\u6743\u9650\u8BBF\u95EE",{type:"error",center:!0}),!1;this.$TOOL.data.set("MENU",r.data.menu),this.$TOOL.data.set("PERMISSIONS",r.data.permissions)}else return console.log("\u62A5\u9519\u4E86"),this.islogin=!1,this.$message.warning(r.message),!1;this.$router.replace({path:"/"}),this.$message.success("Login Success \u767B\u5F55\u6210\u529F"),this.islogin=!1}}},L={class:"login-reg"};function U(o,t,n,r,l,c){const d=y,h=V,p=v,i=P,_=N,f=E,g=O("router-link"),w=S,$=C;return k(),T($,{ref:"loginForm",model:l.form,rules:l.rules,"label-width":"0",size:"large"},{default:s(()=>[e(i,{prop:"user"},{default:s(()=>[e(p,{modelValue:l.form.user,"onUpdate:modelValue":t[1]||(t[1]=a=>l.form.user=a),"prefix-icon":"el-icon-user",clearable:"",placeholder:o.$t("login.userPlaceholder")},{append:s(()=>[e(h,{modelValue:l.userType,"onUpdate:modelValue":t[0]||(t[0]=a=>l.userType=a),style:{width:"130px"}},{default:s(()=>[e(d,{label:o.$t("login.admin"),value:"admin"},null,8,["label"]),e(d,{label:o.$t("login.user"),value:"user"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),_:1}),e(i,{prop:"password"},{default:s(()=>[e(p,{modelValue:l.form.password,"onUpdate:modelValue":t[2]||(t[2]=a=>l.form.password=a),"prefix-icon":"el-icon-lock",clearable:"","show-password":"",placeholder:o.$t("login.PWPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),e(i,{style:{"margin-bottom":"10px"}},{default:s(()=>[e(f,{span:12},{default:s(()=>[e(_,{label:o.$t("login.rememberMe"),modelValue:l.form.autologin,"onUpdate:modelValue":t[3]||(t[3]=a=>l.form.autologin=a)},null,8,["label","modelValue"])]),_:1}),e(f,{span:12,class:"login-forgot"},{default:s(()=>[e(g,{to:"/reset_password"},{default:s(()=>[u(m(o.$t("login.forgetPassword"))+"\uFF1F",1)]),_:1})]),_:1})]),_:1}),e(i,null,{default:s(()=>[e(w,{type:"primary",style:{width:"100%"},loading:l.islogin,round:"",onClick:c.login},{default:s(()=>[u(m(o.$t("login.signIn")),1)]),_:1},8,["loading","onClick"])]),_:1}),I("div",L,[u(m(o.$t("login.noAccount"))+" ",1),e(g,{to:"/user_register"},{default:s(()=>[u(m(o.$t("login.createAccount")),1)]),_:1})])]),_:1},8,["model","rules"])}const M=b(F,[["render",U]]);export{M as default};
